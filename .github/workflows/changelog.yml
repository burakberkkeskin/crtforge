name: Changelog
on:
  push:
    branches:
      - feature/changelog

jobs:
  changelog:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: 'Get Previous Tag'
        id: previousTag
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git fetch --tags
          previousTag=$(git tag --sort=-v:refname | tail -n +2 | head -n 1)
          echo "$previousTag"
          echo "previousTag=$previousTag" >> "$GITHUB_OUTPUT"
      - name: '✏️ Generate release changelog'
        uses: heinrichreimer/action-github-changelog-generator@v2.3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          sinceTag: ${{ steps.previousTag.outputs.previousTag }}
      - name: ' Write the changelog'
        run: cat CHANGELOG.md
